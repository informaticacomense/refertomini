// ======================================================
// REFERTIMINI â€“ powered by Informatica Comense
// Database schema completo
// ======================================================

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ======================================================
// ENUM â€“ Stato partita
// ======================================================
enum GameStatus {
  IN_PROGRAMMA
  CARICATA
  OMOLOGATA
}

// ======================================================
// MODELLO STAGIONE SPORTIVA
// ======================================================
model Season {
  id          String       @id @default(cuid())
  name        String       @unique                     // es: "2025/2026"
  startDate   DateTime
  endDate     DateTime
  committees  Committee[]
  categories  Category[]
  games       Game[]
  createdAt   DateTime     @default(now())
}

// ======================================================
// MODELLO COMITATO (es. FIP Como-Lecco)
// ======================================================
model Committee {
  id          String       @id @default(cuid())
  name        String
  logoUrl     String?
  seasonId    String
  season      Season       @relation(fields: [seasonId], references: [id])
  categories  Category[]
  companies   Company[]
  teams       Team[]
  games       Game[]
  users       User[]
  createdAt   DateTime     @default(now())

  @@unique([seasonId, name])
}

// ======================================================
// MODELLO CATEGORIA (es. Aquilotti, Esordienti, ecc.)
// ======================================================
model Category {
  id          String       @id @default(cuid())
  name        String
  committeeId String
  committee   Committee    @relation(fields: [committeeId], references: [id])
  seasonId    String
  season      Season       @relation(fields: [seasonId], references: [id])
  games       Game[]
  groups      Group[]      // ðŸ‘ˆ relazione 1:N con Group
  createdAt   DateTime     @default(now())

  @@unique([committeeId, name])
}

// ======================================================
// MODELLO GRUPPO / GIRONI
// ======================================================
model Group {
  id          String        @id @default(cuid())
  name        String
  categoryId  String
  category    Category      @relation(fields: [categoryId], references: [id])
  teams       TeamInGroup[] // ðŸ‘ˆ relazione 1:N con TeamInGroup
  createdAt   DateTime      @default(now())

  @@unique([categoryId, name])
}

// ======================================================
// MODELLO SOCIETÃ€ / CLUB
// ======================================================
model Company {
  id          String      @id @default(cuid())
  name        String
  committeeId String
  committee   Committee   @relation(fields: [committeeId], references: [id])
  users       User[]
  teams       Team[]
  createdAt   DateTime    @default(now())

  @@unique([committeeId, name])
}

// ======================================================
// MODELLO TEAM (squadra iscritta ai gironi)
// ======================================================
model Team {
  id          String      @id @default(cuid())
  name        String
  committeeId String
  committee   Committee   @relation(fields: [committeeId], references: [id])
  companyId   String?
  company     Company?    @relation(fields: [companyId], references: [id])
  gamesA      Game[]      @relation("TeamA")
  gamesB      Game[]      @relation("TeamB")
  groups      TeamInGroup[]
  createdAt   DateTime    @default(now())

  @@unique([committeeId, name])
}

// ======================================================
// MODELLO TEAM IN GROUP (iscrizione squadre ai gironi)
// ======================================================
model TeamInGroup {
  id        String   @id @default(cuid())
  teamId    String
  team      Team     @relation(fields: [teamId], references: [id])
  groupId   String
  group     Group    @relation(fields: [groupId], references: [id])
  createdAt DateTime @default(now())

  @@unique([teamId, groupId])
}

// ======================================================
// MODELLO PARTITA
// ======================================================
model Game {
  id           String      @id @default(cuid())
  date         DateTime
  timeStr      String?
  dayName      String?
  groupName    String?
  phase        String?
  result       String?
  status       GameStatus  @default(IN_PROGRAMMA)
  seasonId     String
  season       Season      @relation(fields: [seasonId], references: [id])
  committeeId  String
  committee    Committee   @relation(fields: [committeeId], references: [id])
  categoryId   String
  category     Category    @relation(fields: [categoryId], references: [id])
  teamAId      String
  teamA        Team        @relation("TeamA", fields: [teamAId], references: [id])
  teamBId      String
  teamB        Team        @relation("TeamB", fields: [teamBId], references: [id])
  createdAt    DateTime    @default(now())
}

// ======================================================
// MODELLO UTENTE (per accesso admin / societÃ  / comitato)
// ======================================================
model User {
  id          String     @id @default(cuid())
  name        String
  email       String     @unique
  password    String
  role        String     @default("USER") // es: SUPERADMIN / COMMITTEE / COMPANY / USER
  committeeId String?
  committee   Committee? @relation(fields: [committeeId], references: [id])
  companyId   String?
  company     Company?   @relation(fields: [companyId], references: [id])
  createdAt   DateTime   @default(now())
isSuperAdmin Boolean @default(false)

}
