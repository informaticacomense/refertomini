// ======================================================
// REFERTIMINI – powered by Informatica Comense
// Database schema: referti-minibasket
// ======================================================

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ======================================================
// ENUM – stato partita
// ======================================================
enum GameStatus {
  IN_PROGRAMMA
  CARICATA
  OMOLOGATA
}

// ======================================================
// MODELLO STAGIONE SPORTIVA
// ======================================================
model Season {
  id          String       @id @default(cuid())
  name        String       @unique                     // es: "2024/2025"
  startDate   DateTime
  endDate     DateTime
  committees  Committee[]
  categories  Category[]
  games       Game[]
  createdAt   DateTime     @default(now())
}

// ======================================================
// MODELLO COMITATO (es. FIP Como-Lecco)
// ======================================================
model Committee {
  id          String       @id @default(cuid())
  name        String
  logoUrl     String?
  seasonId    String
  season      Season       @relation(fields: [seasonId], references: [id])
  categories  Category[]
  companies   Company[]
  teams       Team[]
  games       Game[]
  users       User[]
  createdAt   DateTime     @default(now())
}

// ======================================================
// MODELLO CATEGORIA (es. Aquilotti, Scoiattoli, Esordienti)
// ======================================================
model Category {
  id          String       @id @default(cuid())
  name        String
  committeeId String
  committee   Committee    @relation(fields: [committeeId], references: [id])
  seasonId    String
  season      Season       @relation(fields: [seasonId], references: [id])
  games       Game[]
  createdAt   DateTime     @default(now())

  @@unique([committeeId, name])
}

// ======================================================
// MODELLO SOCIETÀ / CLUB
// ======================================================
model Company {
  id          String      @id @default(cuid())
  name        String
  committeeId String
  committee   Committee   @relation(fields: [committeeId], references: [id])
  users       User[]
  teams       Team[]
  createdAt   DateTime    @default(now())

  @@unique([committeeId, name])
}

// ======================================================
// MODELLO TEAM (squadra iscritta ai gironi)
// ======================================================
model Team {
  id          String      @id @default(cuid())
  name        String
  committeeId String
  committee   Committee   @relation(fields: [committeeId], references: [id])
  companyId   String?
  company     Company?    @relation(fields: [companyId], references: [id])
  gamesA      Game[]      @relation("TeamA")
  gamesB      Game[]      @relation("TeamB")
  groups      TeamInGroup[]
  createdAt   DateTime    @default(now())

  @@unique([committeeId, name])
}

// ======================================================
// MODELLO PARTITA
// ======================================================
model Game {
  id           String      @id @default(cuid())
  date         DateTime
  timeStr      String?
  dayName      String?
  groupName    String?
  phase        String?
  result       String?
  status       GameStatus  @default(IN_PROGRAMMA)
  seasonId     String
  season       Season      @relation(fields: [seasonId], references: [id])
  committeeId  String
  committee    Committee   @relation(fields: [committeeId], references: [id])
  categoryId   String
  category     Category    @relation(fields: [categoryId], references: [id])
  teamAId      String
  teamA        Team        @relation("TeamA", fields: [teamAId], references: [id])
  teamBId      String
  teamB        Team        @relation("TeamB", fields: [teamBId], references: [id])
  createdAt    DateTime    @default(now())
}

// ======================================================
// MODELLO TEAM IN GROUP (partecipazione ai gironi)
// ======================================================
model TeamInGroup {
  id        String   @id @default(cuid())
  teamId    String
  team      Team     @relation(fields: [teamId], references: [id])
  groupName String
  createdAt DateTime @default(now())

  @@unique([teamId, groupName])
}

// ======================================================
// MODELLO UTENTE (per accesso admin / società / comitato)
// ======================================================
model User {
  id          String     @id @default(cuid())
  name        String
  email       String     @unique
  password    String
  role        String     @default("USER") // es: SUPERADMIN / COMMITTEE / COMPANY / USER
  committeeId String?
  committee   Committee? @relation(fields: [committeeId], references: [id])
  companyId   String?
  company     Company?   @relation(fields: [companyId], references: [id])
  createdAt   DateTime   @default(now())
}
